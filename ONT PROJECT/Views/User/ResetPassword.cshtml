@model ResetPasswordViewModel
@{
    ViewData["Title"] = "Reset Password";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-light d-flex align-items-center justify-content-center vh-100">

    <div class="card shadow-lg border-0 rounded-3" style="max-width: 420px; width: 100%;">
        <div class="card-body p-4">
            <h3 class="text-center mb-4 text-primary">🔑 Reset Password</h3>

            @if (TempData["SuccessMessage"] != null)
            {
                <div class="alert alert-success">@TempData["SuccessMessage"]</div>
            }

            <form id="resetForm" method="post" action="@Url.Action("ResetPassword", "User")">
                @Html.AntiForgeryToken()
                <input type="hidden" name="Email" value="@Model.Email" />

                <div class="mb-3">
                    <label asp-for="TemporaryPassword" class="form-label"></label>
                    <input asp-for="TemporaryPassword" class="form-control" type="password" placeholder="Enter temporary password" />
                    <span asp-validation-for="TemporaryPassword" class="text-danger small"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="NewPassword" class="form-label"></label>
                    <input asp-for="NewPassword" class="form-control" type="password" placeholder="Enter new password" />
                    <span asp-validation-for="NewPassword" class="text-danger small"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="ConfirmPassword" class="form-label"></label>
                    <input asp-for="ConfirmPassword" class="form-control" type="password" placeholder="Confirm new password" />
                    <span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
                </div>

                <button type="submit" class="btn btn-primary w-100">Reset</button>
            </form>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <partial name="_ValidationScriptsPartial" />

    <script>
        $(document).ready(function () {

            // Handle TempData success modal (for full-page postbacks)
            var successMessage = '@TempData["SuccessMessage"]';
            if (successMessage) {
                Swal.fire({
                    icon: "success",
                    title: "Password Changed",
                    text: successMessage,
                    confirmButtonText: "OK"
                }).then(() => {
                    window.location.href = "/User/Login";
                });
            }

            // AJAX form submission
            $("#resetForm").submit(function (e) {
                e.preventDefault(); // prevent normal form submission

                $.ajax({
                    url: $(this).attr("action"),
                    type: "POST",
                    data: $(this).serialize(),
                    dataType: "json", // expect JSON from the controller
                    success: function (response) {
                        if (response.success) {
                            // Show success message and redirect
                            Swal.fire({
                                icon: "success",
                                title: "Password Changed",
                                text: response.message,
                                confirmButtonText: "OK"
                            }).then(() => {
                                window.location.href = "/User/Login";
                            });
                        } else if (response.errors && response.errors.length > 0) {
                            // Show server-side validation errors
                            Swal.fire({
                                icon: "error",
                                title: "Oops...",
                                html: response.errors.join("<br/>")
                            });
                        } else {
                            // Fallback for unexpected responses
                            Swal.fire({
                                icon: "error",
                                title: "Oops...",
                                text: "Something went wrong. Please try again."
                            });
                        }
                    },
                    error: function () {
                        Swal.fire({
                            icon: "error",
                            title: "Oops...",
                            text: "Something went wrong. Please try again."
                        });
                    }
                });
            });

        });
    </script>



</body>
</html>
