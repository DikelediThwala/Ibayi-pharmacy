@model ONT_PROJECT.Models.Prescription

@{
    ViewData["Title"] = "UPLOAD PRESCRIPTION";
    Layout = "_CustomerLayout";
}

<div class="p-5" style="background-color: #d9eaff; border-radius: 12px; max-width: 900px; margin: 0 auto; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
    <h2 class="mb-4 text-uppercase fw-bold text-center">UPLOAD PRESCRIPTION</h2>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @using (Html.BeginForm("UploadPrescription", "Customer", FormMethod.Post, new { enctype = "multipart/form-data", @class = "needs-validation", novalidate = "novalidate" }))
    {
        <div class="mb-4">
            @Html.LabelFor(m => m.PrescriptionPhoto, "Select PDF Prescription", new { @class = "form-label fw-semibold" })
            <input type="file"
                   name="PrescriptionFile"
                   id="PrescriptionFile"
                   accept="application/pdf"
                   class="form-control form-control-lg"
                   required />
            <div class="invalid-feedback">
                Please select a PDF prescription file.
            </div>
        </div>

        <div class="form-check mb-5">
            <input class="form-check-input" type="checkbox" name="DispenseRequest" id="DispenseRequest" />
            <label class="form-check-label" for="DispenseRequest">
                I want my prescription to be dispensed
            </label>
        </div>

        <div class="mb-4">
            <h5>PDF Preview:</h5>
            <iframe id="pdfPreview" style="display:none; border: 1px solid #ccc;" width="100%" height="500px"></iframe>
        </div>

        <button type="submit" class="btn btn-primary btn-lg px-5 py-3 w-100">Upload</button>
    }
</div> 
@*
@section Scripts { *@
    <script>
        // Bootstrap form validation
        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms).forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }
                    form.classList.add('was-validated')
                }, false)
            })
        })()

        // PDF preview
        document.getElementById("PrescriptionFile").addEventListener("change", function (e) {
            var file = e.target.files[0];
            var preview = document.getElementById("pdfPreview");

            if (file && file.type === "application/pdf") {
                var fileURL = URL.createObjectURL(file);
                preview.src = fileURL;
                preview.style.display = "block";
            } else {
                preview.src = "";
                preview.style.display = "none";
                alert("Please select a valid PDF file.");
            }
        });
    </script>
}
