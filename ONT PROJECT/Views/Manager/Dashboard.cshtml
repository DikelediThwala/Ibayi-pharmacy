@model ONT_PROJECT.Models.ManagerDashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
    Layout = "_ManagerLayout";
}

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
    body {
        background-color: #f5f7fa;
        font-family: 'Inter', sans-serif;
    }

    h2.dashboard-header {
        font-size: 28px;
        font-weight: bold;
        color: #011425;
        margin-bottom: 15px;
    }

    hr.dashboard-separator {
        height: 4px;
        background-color: #011425;
        border: none;
        margin-bottom: 30px;
    }

    /* Section titles */
    .dashboard-section-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #011425;
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        padding: 8px 12px;
        border-left: 5px solid #6c5ce7;
        background-color: #f8f9fa;
        border-radius: 8px;
    }

        .dashboard-section-title i {
            font-size: 1.4rem;
            color: #6c5ce7;
        }

    /* Unified card style */
    .dashboard-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transition: transform 0.2s, box-shadow 0.2s;
        height: 150px;
        text-align: center;
        font-weight: 600;
        color: #011425;
    }

        .dashboard-card i {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

    /* Background colors for count cards */
    .bg-soft-primary {
        background-color: #e3f2fd;
    }

    .bg-soft-success {
        background-color: #e6f4ea;
    }

    .bg-soft-info {
        background-color: #e5f6fd;
    }

    .bg-soft-warning {
        background-color: #fff4e5;
    }

    .dashboard-card .fs-4 {
        margin: 6px 0;
    }

    /* Quick action cards */
    .quick-action-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: #fff;
        padding: 16px;
        border-radius: 12px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        transition: all 0.2s ease-in-out;
        height: 110px;
        text-align: center;
        font-weight: 600;
        color: #011425;
    }

        .quick-action-card i {
            font-size: 1.6rem;
            margin-bottom: 6px;
        }

        .quick-action-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 18px rgba(0,0,0,0.12);
            background: #f9f9f9;
        }

    /* Table wrapper */
    .table-wrapper {
        overflow-x: auto;
        ax-height: 5200px;
    }

    table.table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 8px;
    }

        table.table thead th {
            background-color: #6c5ce7;
            color: #fff;
            font-weight: 600;
            padding: 12px 15px;
            border-radius: 8px 8px 0 0;
            text-align: left;
        }

        table.table tbody tr {
            background-color: #fff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            border-radius: 8px;
            margin-bottom: 6px;
        }

            table.table tbody tr:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            }

        table.table td {
            padding: 10px 15px;
            vertical-align: middle;
        }

    /* Medicine pill badges */
    .med-badge {
        display: inline-block;
        background-color: #dfe6ff;
        color: #2d3436;
        padding: 3px 8px;
        margin: 2px 2px 2px 0;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    /* Status badges */
    .badge-status {
        font-size: 0.75rem;
        font-weight: 500;
        padding: 5px 10px;
        border-radius: 20px;
    }

    .badge-pending {
        background-color: #ffeaa7;
        color: #2d3436;
    }

    .badge-received {
        background-color: #55efc4;
        color: #2d3436;
    }

    .badge-other {
        background-color: #dfe6e9;
        color: #636e72;
    }

    /* Recent activities table */
    .activity-table td {
        font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-size: 0.9rem;
        color: #011425;
    }

        .activity-table td .activity-desc {
            color: #6c5ce7;
            font-weight: 500;
            font-size: 0.95rem;
            font-style: italic;
        }

        .activity-table td .activity-date {
            font-size: 0.85rem;
            color: #636e72;
            text-align: right;
        }
</style>

<h2 class="dashboard-header">Pharmacy Manager Dashboard</h2>
<hr class="dashboard-separator" />

<div class="container py-3">
    <!-- Counts Section -->
    <div class="row gx-3 gy-3 mb-4">
        <div class="col-md-3">
            <a href="@Url.Action("Index", "B_Order")" class="text-decoration-none">
                <div class="dashboard-card bg-soft-warning">
                    <i class="bi bi-exclamation-triangle-fill text-warning"></i>
                    <div class="fs-4 fw-bold">@Model.LowStockCount</div>
                    <span>Medicine Low in Stock</span>
                </div>
            </a>
        </div>

        <div class="col-md-3">
            <a asp-controller="Supplier" asp-action="Index" class="text-decoration-none">
                <div class="dashboard-card bg-soft-success">
                    <i class="bi bi-truck text-success"></i>
                    <div class="fs-4 fw-bold">@Model.TotalSuppliers</div>
                    <span>Active Suppliers</span>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a asp-controller="User" asp-action="Index" class="text-decoration-none">
                <div class="dashboard-card bg-soft-info">
                    <i class="bi bi-person-badge text-info"></i>
                    <div class="fs-4 fw-bold">@Model.TotalPharmacists</div>
                    <span>Active Pharmacists</span>
                </div>
            </a>
        </div>
        <div class="col-md-3">
            <a asp-controller="Doctor" asp-action="Index" class="text-decoration-none">
                <div class="dashboard-card bg-soft-warning">
                    <i class="fas fa-stethoscope text-warning"></i>
                    <div class="fs-4 fw-bold">@Model.TotalDoctors</div>
                    <span>Active Doctors</span>
                </div>
            </a>
        </div>
    </div>

    <!-- Dashboard Sections Row -->
    <div class="row gx-4 gy-4 mt-4">
        <!-- Quick Actions -->
        <div class="col-lg-8">
            <div class="row gx-3 gy-3">
                <div class="dashboard-section-title">
                    <i class="fas fa-bolt"></i> Quick Actions
                </div>
                <!-- Quick Action Cards -->
                <div class="col-md-3">
                    <a asp-controller="Medicine" asp-action="Create" class="quick-action-card text-decoration-none">
                        <i class="bi bi-capsule text-primary"></i>
                        <span>Add Medicine</span>
                    </a>
                </div>
                <div class="col-md-3">
                    <a asp-controller="Supplier" asp-action="Create" class="quick-action-card text-decoration-none">
                        <i class="bi bi-building text-success"></i>
                        <span>Add Supplier</span>
                    </a>
                </div>
                <div class="col-md-3">
                    <a asp-controller="B_Order" asp-action="Index" asp-route-tab="neworder" class="quick-action-card text-decoration-none">
                        <i class="bi bi-cart-plus text-warning"></i>
                        <span>Order Medication</span>
                    </a>
                </div>
                <div class="col-md-3">
                    <a asp-controller="User" asp-action="Create" class="quick-action-card text-decoration-none">
                        <i class="bi bi-person-plus text-info"></i>
                        <span>Add Pharmacist</span>
                    </a>
                </div>
                <div class="col-md-3">
                    <a asp-controller="DosageForm" asp-action="Create" class="quick-action-card text-decoration-none">
                        <i class="bi bi-journal-medical text-primary"></i>
                        <span>Add Dosage Form</span>
                    </a>
                </div>
                <div class="col-md-3">
                    <a asp-controller="ActiveIngredient" asp-action="Create" class="quick-action-card text-decoration-none">
                        <i class="bi bi-box-seam text-success"></i>
                        <span>Add Ingredient</span>
                    </a>
                </div>
                <div class="col-md-3">
                    <a asp-controller="Doctor" asp-action="Create" class="quick-action-card text-decoration-none">
                        <i class="bi bi-person-plus text-warning"></i>
                        <span>Add Doctor</span>
                    </a>
                </div>
                <div class="col-md-3">
                    <a asp-controller="ManagerReport" asp-action="Index" class="quick-action-card text-decoration-none">
                        <i class="bi bi-file-earmark-pdf text-danger"></i>
                        <span>Generate Report</span>
                    </a>
                </div>
            </div>

            <!-- Recent Orders -->
            <div class="card p-3 mt-4">
                <div class="dashboard-section-title"><i class="fas fa-clipboard-list"></i> Recent Orders</div>
                <div class="d-flex justify-content-end mb-2">
                    <select id="statusFilter" class="form-select form-select-sm w-auto" onchange="filterOrdersByStatus()">
                        <option value="">All</option>
                        <option value="Pending">Pending</option>
                        <option value="Received">Received</option>
                    </select>
                </div>
                <div class="table-wrapper">
                    <table id="recentOrdersTable" class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Medicines</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var order in Model.RecentOrders)
                            {
                                <tr class="order-row"
                                    data-href="@Url.Action("Index", "B_Order", new { tab = "orders", id = order.BOrderId })"
                                    data-status="@order.Status">

                                    <td>@order.BOrderId</td>
                                    <td>@order.DatePlaced.ToShortDateString()</td>
                                    <td>
                                        @foreach (var line in order.BOrderLines)
                                        {
                                            <span class="med-badge">@line.Medicine.MedicineName</span>
                                        }
                                    </td>
                                    <td>
                                        @switch (order.Status)
                                        {
                                            case "Pending":
                                                <span class="badge-status badge-pending">Pending</span>
                                                break;
                                            case "Received":
                                                <span class="badge-status badge-received">Received</span>
                                                break;
                                            default:
                                                <span class="badge-status badge-other">@order.Status</span>
                                                break;
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Recent Activities -->
        <div class="col-lg-4">
            <div class="card h-100">
                <div class="dashboard-section-title"><i class="fas fa-history"></i> Recent Activities</div>
                <div class="table-wrapper">
                    <table class="table table-borderless mb-0 activity-table">
                        <tbody>
                            @if (Model.RecentActivities.Any())
                            {
                                @foreach (var activity in Model.RecentActivities)
                                {
                                    <tr>
                                        <td><span class="activity-desc">@activity.Description</span></td>
                                        <td class="activity-date">@activity.DatePerformed.ToString("dd/MM/yyyy HH:mm")</td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="2" class="text-muted">No activities yet.</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function filterOrdersByStatus() {
            const filterValue = document.getElementById('statusFilter').value;
            const rows = document.querySelectorAll('#recentOrdersTable tbody tr'); // only orders
            rows.forEach(row => {
                const status = row.getAttribute('data-status');
                row.style.display = (!filterValue || status === filterValue) ? '' : 'none';
            });
        }
    </script>

    
    <script>
        function filterOrdersByStatus() {
            const filterValue = document.getElementById('statusFilter').value;
            const rows = document.querySelectorAll('#recentOrdersTable tbody tr');
            rows.forEach(row => {
                const status = row.getAttribute('data-status');
                row.style.display = (!filterValue || status === filterValue) ? '' : 'none';
            });
        }

        // 🟢 Make rows clickable
        document.addEventListener("DOMContentLoaded", function () {
            const rows = document.querySelectorAll(".order-row");
            rows.forEach(row => {
                row.addEventListener("click", function () {
                    const href = this.getAttribute("data-href");
                    if (href) {
                        window.location.href = href;
                    }
                });
                // Optional: Change cursor for UX
                row.style.cursor = "pointer";
            });
        });
    </script>

}
