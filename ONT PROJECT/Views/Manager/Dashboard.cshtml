@model ONT_PROJECT.Models.ManagerDashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
    Layout = "_ManagerLayout";
}

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
    body {
        background-color: #f5f7fa;
    }

    h2.dashboard-header {
        font-size: 28px;
        font-weight: bold;
        color: #011425;
        margin-bottom: 15px;
    }

    hr.dashboard-separator {
        height: 4px;
        background-color: #011425;
        border: none;
        margin-bottom: 30px;
    }

    /* Keep your counting cards as-is */
    .info-card {
        background-color: #fff;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transition: transform 0.2s;
        text-align: center;
        height: 100%;
    }

        .info-card:hover {
            transform: translateY(-4px);
        }

    .info-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }

    .info-context {
        font-size: 0.85rem;
        color: #6c757d;
    }

    .bg-soft-primary {
        background-color: #e3f2fd;
    }

    .bg-soft-success {
        background-color: #e6f4ea;
    }

    .bg-soft-info {
        background-color: #e5f6fd;
    }

    .bg-soft-warning {
        background-color: #fff4e5;
    }

    .dashboard-section-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #011425;
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        padding: 8px 12px;
        border-left: 5px solid #6c5ce7;
        background-color: #f8f9fa;
        border-radius: 8px;
    }

        .dashboard-section-title i {
            font-size: 1.4rem;
            color: #6c5ce7;
        }

    .table-wrapper {
        overflow-x: auto;
        max-height: 320px;
    }

    table.table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 8px; /* space between rows for a card-like look */
    }

        table.table thead th {
            background-color: #6c5ce7;
            color: #fff;
            font-weight: 600;
            padding: 12px 15px;
            border-radius: 8px 8px 0 0;
            text-align: left;
        }

        table.table tbody tr {
            background-color: #fff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            border-radius: 8px;
            margin-bottom: 6px;
            display: table-row;
        }

            table.table tbody tr:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            }

        table.table td {
            padding: 10px 15px;
            vertical-align: middle;
        }

    /* Medicine pill badges */
    .med-badge {
        display: inline-block;
        background-color: #dfe6ff;
        color: #2d3436;
        padding: 3px 8px;
        margin: 2px 2px 2px 0;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    /* Status badges */
    .badge-status {
        font-size: 0.75rem;
        font-weight: 500;
        padding: 5px 10px;
        border-radius: 20px;
    }

    .badge-pending {
        background-color: #ffeaa7;
        color: #2d3436;
    }

    .badge-received {
        background-color: #55efc4;
        color: #2d3436;
    }

    .badge-other {
        background-color: #dfe6e9;
        color: #636e72;
    }

    .activity-table td {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-size: 0.9rem;
        color: #011425; /* main dark color */
    }


        .activity-table td .activity-desc {
            color: #6c5ce7;
            /* purple for activity type */
            /* darker gray for description */
        }

        .activity-table td .activity-date {
            font-size: 0.8rem;
            color: #636e72; /* muted gray for date */
            text-align: right;
        }

        .activity-table td .activity-desc {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #6c5ce7; /* nice purple for description */
            font-weight: 500;
            font-size: 0.95rem;
            font-style: italic;
        }

        

        .activity-table td .activity-date {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 0.85rem;
            color: #636e72; /* muted gray for date */
            text-align: right;
        }

  </style>

<h2 class="dashboard-header">Pharmacy Manager Dashboard</h2>
<hr class="dashboard-separator" />

<div class="container py-3">
    <!-- Info Cards Row (keep your styling) -->
    <div class="row gx-3 gy-3 dashboard-cards">
        <div class="col-md-3">
            <a asp-controller="Medicine" asp-action="Index" style="text-decoration:none;">
                <div class="info-card bg-soft-primary text-dark">
                    <div class="info-icon text-primary"><i class="bi bi-capsule-pill"></i></div>
                    <strong>Total Medications</strong>
                    <div class="fs-4 fw-bold">8</div>
                    <div class="info-context">Active medicines in stock</div>
                </div>
            </a>
        </div>

        <div class="col-md-3">
            <a asp-controller="Supplier" asp-action="Index" style="text-decoration:none;">
                <div class="info-card bg-soft-success text-dark">
                    <div class="info-icon text-success"><i class="bi bi-truck"></i></div>
                    <strong>Suppliers</strong>
                    <div class="fs-4 fw-bold">7</div>
                    <div class="info-context">Partners delivering stock</div>
                </div>
            </a>
        </div>

        <div class="col-md-3">
            <a asp-controller="User" asp-action="Index" style="text-decoration:none;">
                <div class="info-card bg-soft-info text-dark">
                    <div class="info-icon text-info"><i class="bi bi-person-badge"></i></div>
                    <strong>Pharmacists</strong>
                    <div class="fs-4 fw-bold">3</div>
                    <div class="info-context">Registered system pharmacists</div>
                </div>
            </a>
        </div>

        <div class="col-md-3">
            <a asp-controller="Doctor" asp-action="Index" style="text-decoration:none;">
                <div class="info-card bg-soft-warning text-dark">
                    <div class="info-icon text-warning"><i class="bi bi-stethoscope"></i></div>
                    <strong>Doctors</strong>
                    <div class="fs-4 fw-bold">4</div>
                    <div class="info-context">Doctors with prescription rights</div>
                </div>
            </a>
        </div>
    </div>



    <!-- Dashboard Sections Row -->
    <div class="row gx-4 gy-4 mt-4">

        <div class="col-lg-8">
            <div class="card p-3" style="height: 100%;">
                <div class="dashboard-section-title"><i class="fas fa-clipboard-list"></i> Recent Orders</div>
                <div class="d-flex justify-content-end mb-2">
                    <select id="statusFilter" class="form-select form-select-sm w-auto" onchange="filterOrdersByStatus()">
                        <option value="">All</option>
                        <option value="Pending">Pending</option>
                        <option value="Received">Received</option>
                    </select>
                </div>
                <div class="table-wrapper">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Medicines</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var order in Model.RecentOrders)
                            {
                                <tr data-status="@order.Status">
                                    <td>@order.BOrderId</td>
                                    <td>@order.DatePlaced.ToShortDateString()</td>
                                    <td>
                                        @foreach (var line in order.BOrderLines)
                                        {
                                            <span class="med-badge">@line.Medicine.MedicineName</span>
                                        }
                                    </td>
                                    <td>
                                        @switch (order.Status)
                                        {
                                            case "Pending":
                                                <span class="badge-status badge-pending">Pending</span>
                                                break;
                                            case "Received":
                                                <span class="badge-status badge-received">Received</span>
                                                break;
                                            default:
                                                <span class="badge-status badge-other">@order.Status</span>
                                                break;
                                        }
                                    </td>
                                </tr>
                            }

                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Recent Activities (Tall) -->
        <div class="col-lg-4">

            <div class="card" style="height: 100%;">
                <div class="dashboard-section-title"><i class="fas fa-history"></i> Recent Activities</div>

                <div class="table-wrapper">
                    <table class="table table-borderless mb-0 activity-table">
                        <tbody>
                            @if (Model.RecentActivities.Any())
                            {
                                @foreach (var activity in Model.RecentActivities)
                                {
                                    <tr>
                                        <td>
                                            <span class="activity-desc">@activity.Description</span>
                                        </td>
                                        <td class="activity-date">@activity.DatePerformed.ToString("dd/MM/yyyy HH:mm")</td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="2" class="text-muted">No activities yet.</td>
                                </tr>
                            }
                        </tbody>
                    </table>

                </div>

            </div>
       
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function filterOrdersByStatus() {
            const filterValue = document.getElementById('statusFilter').value;
            const rows = document.querySelectorAll('table tbody tr');

            rows.forEach(row => {
                const status = row.getAttribute('data-status');
                row.style.display = (!filterValue || status === filterValue) ? '' : 'none';
            });
        }
    </script>
}